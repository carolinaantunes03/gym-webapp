{% extends 'base.html' %}
{% load static %}

{% block title %}As Minhas Reservas{% endblock %}

{% block content %}
<style>
    body { background-color: #f5f5f5; }

    .schedule-container {
        max-width: 95%;
        margin: 40px auto;
        background-color: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    table { width: 100%; border-collapse: collapse; text-align: center; }
    th { background:#f7c26d; color:white; padding:10px; }
    td { border:1px solid #ddd; height:100px; vertical-align:top; font-size:0.9rem; }

    .reserva-card {
        background:#ff7f50;
        color:white;
        border-radius:6px;
        padding:5px;
        margin:3px;
        position: relative;
        overflow: hidden;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        font-size:0.85rem;
    }

    .reserva-card.pt {
        background:#6fa8dc; /* cor diferente para sessões PT */
    }

    .reserva-card:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }

    .btn-cancelar {
        position: absolute;
        bottom: 5px;
        right: 5px;
        background-color: rgba(255,255,255,0.9);
        color: #ff7f50;
        padding: 5px 10px;
        border-radius: 6px;
        text-decoration: none;
        font-weight: bold;
        font-size: 0.75rem;
        opacity: 0;
        transition: all 0.3s ease;
    }

    .reserva-card:hover .btn-cancelar {
        opacity: 1;
        transform: translateY(-3px);
    }

    .btn-cancelar:hover {
        background-color: #ff7f50;
        color: white;
    }

    .nav-buttons { text-align:center; margin-bottom:20px; }
    .nav-buttons a {
        background:#f7c26d; color:white; padding:8px 15px;
        margin:0 10px; border-radius:8px; text-decoration:none; font-weight:bold;
    }
    .nav-buttons a:hover { background:#f7c26d; }
</style>

<div class="schedule-container">
    <h2 class="text-center mb-3">As Minhas Reservas</h2>

    <table>
        <thead>
            <tr>
                <th>Hora</th>
                <th>Reserva</th>
            </tr>
        </thead>
        <tbody>
            {% for reserva in reservas_aulas %}
            <tr>
                <td>{{ reserva.aula.horario_inicio|date:"d/m/Y H:i" }}</td>
                <td>
                    <div class="reserva-card">
                        <strong>{{ reserva.aula.nome }}</strong><br>
                        {{ reserva.aula.duracao_min }} min<br>
                        Instrutor: {{ reserva.aula.instrutor.display_name }}
                        <form action="{% url 'toggle_reserva' reserva.aula.id %}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn-cancelar">Cancelar</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}

            {% for pt in reservas_pt %}
            <tr>
                <td>{{ pt.horario|date:"d/m/Y H:i" }}</td>
                <td>
                    <div class="reserva-card pt">
                        <strong>PT Session</strong><br>
                        {{ pt.duracao_min }} min<br>
                        Instrutor: {{ pt.instrutor.display_name }}
                        <form action="{% url 'cancelar_pt' pt.id %}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn-cancelar">Cancelar</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="2">Ainda não tens reservas.</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="text-center mt-4">
        <a href="{% url 'aluno_dashboard' %}" class="btn-back"
           style="background:#6c757d;color:white;padding:10px 20px;border-radius:8px;text-decoration:none;">
           Voltar à página inicial
        </a>
    </div>
</div>
{% endblock %}
